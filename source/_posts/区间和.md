---
title: 区间和
date: 2020-11-08 21:22:32
tags: [leetcode,线段树]
---

要用到线段树这个数据结构

主要的方法有：建树，更新，区间和，都可以使用递归来实现。
<!--more-->
```c++
class NumArray {
    vector<int> nums;
    int arr[MAX_LEN] = {0};

   public:
    NumArray(vector<int>& nums) {
        this->nums = nums;
        if(nums.size()>0)
            build_tree(0, nums.size() - 1, 0);
    }

    void update(int i, int val) {
        update_helper(i, 0, nums.size() - 1, val, 0);
    }

    void update_helper(int i, int l, int r, int val, int node) {
        if (l == r) {
            nums[i] = val;
            arr[node] = val;
            return;
        }
        int mid = (l + r) / 2;
        int left_node = (node + 1) * 2 - 1;
        int right_node = (node + 1) * 2;
        if (i <= mid) {
            update_helper(i, l, mid, val, left_node);
        } else {
            update_helper(i, mid + 1, r, val, right_node);
        }
        arr[node] = arr[left_node] + arr[right_node];
    }

    int sumRange(int i, int j) { 
        return sumRangeHelper(i,j,0,nums.size()-1,0); 
        }

    int sumRangeHelper(int i, int j, int l, int r, int node) {
        if(l==r||(i==l)&&(j==r)){
            return arr[node];
        }
        int mid = (l + r) / 2;
        int left_node = (node + 1) * 2 - 1;
        int right_node = (node + 1) * 2;
        if (j <= mid) {
            return sumRangeHelper(i, j, l, mid, left_node);
        } else if (i > mid) {
            return sumRangeHelper(i, j, mid + 1, r, right_node);
        } else {
            return sumRangeHelper(i, mid, l, mid, left_node) +
                   sumRangeHelper(mid+1, j, mid + 1, r, right_node);
        }
    }

    void build_tree(int l, int r, int node) {
        if (l == r) {
            arr[node] = nums[l];
            return;
        }
        int mid = (l + r) / 2;
        int left_node = (node + 1) * 2 - 1;
        int right_node = (node + 1) * 2;
        build_tree(l, mid, left_node);
        build_tree(mid + 1, r, right_node);
        arr[node] = arr[left_node] + arr[right_node];
    }
};
```